<<<<<<< Updated upstream
"use strict";function contrainValue(e,t,n){return t=t||0,n=n||10,e=_.isFinite(e)?e:1,e=Math.max(t,e),e=Math.min(n,e)}function drawSpreadSheet(e,t){e=contrainValue(e,1,27),t=contrainValue(t,1,20);for(var n=document.querySelector("table"),r=0;r<t;r++)for(var o=n.insertRow(-1),a=0;a<e;a++){var i=String.fromCharCode("A".charCodeAt(0)+a-1);o.insertCell(-1).innerHTML=r&&a?"<input id='"+i+r+"' class='spreadsheet-cell' />":r||i}}function processElements(e,t){function n(e,t){return e+t}function r(e,t){return e-t}function o(e,t){return e*t}function a(e,t){return 0===t?0:e/t}function i(e,t){return console.log("a ^ b:",e,t),Math.pow(e,t)}function l(e,t,n){var r="",o=s(e.left,n);return r=e.right?s(e.right,n):Bacon.constant(0),o.combine(r,t)}function s(e,t){var u=0,c=0,d=0;if("number"===e.type)d=Bacon.constant(parseFloat(e.token));else if("cellname"===e.type)d=spreadSheet.getCellById(e.token),t.push(d),d=d.bus;else if("unary"===e.type)c=s(e.right,t),"+"===e.token?d=c:(u=Bacon.constant(0),d=u.combine(c,r));else if("leftparen"===e.type)u=s(e.left,t),c=e.right,"rightparen"===c.type&&(d=u);else if("operator"===e.type)switch(e.token){case"+":d=l(e,n,t);break;case"-":d=l(e,r,t);break;case"*":d=l(e,o,t);break;case"/":d=l(e,a,t);break;case"^":d=l(e,i,t)}return d}function u(e,t,n){e.value=n,t.is(":focus")?t.val(e.formula):t.val(e.value),localStorage[e.id]=e.formula,e.pusher()}INPUTS.each(function(t,n){var r=$(n),o={element:r,id:r.attr("id")},a=[];cells.push(o),e.filter(function(e){return e.element===o.id}).onValue(function(e){var t=spreadSheet.getCellById(e.element),n=e.formula.toUpperCase();e.timestamp>t.lastUpdated?(a=[],t.formula=n,t.dispose&&t.dispose(),t.dispose=null,_.isUndefined(n)||""===n?(u(t,r,0),t.expanded="0"):(n=window.parser.parse(n.replace("=",""),t.id),_.isString(n)&&/ERROR/gi.test(n)?u(t,r,n):(t.dispose=s(n,a).onValue(function(e){u(t,r,e)}),a=_.uniqBy(a,function(e){return e.id}),_.forEach(a,function(e){e.pusher()})))):console.log("server update rejected:",e)}),r.asEventStream("focus").onValue(function(e){var t=e.target.id,n=spreadSheet.getCellById(t),o=n.formula;r.val(o)}),r.asEventStream("blur").map(function(e){var t=e.target.id,n=e.target.value;return{element:t,formula:n,user_id:userId}}).onValue(function(e){socket.emit("write",e)})}),spreadSheet.addCells(cells),window.parser.setSpreadSheet(spreadSheet),e.onValue(function(e){console.log("update:",e)})}var _=_,Bacon=Bacon,CellFactory=function(){function e(e){this.id=e.id,this.element=e.element,this.value=0,this.expanded="0",this.lastUpdated=0,this.dispose=null,this.bus=new Bacon.Bus}return e.prototype.pusher=function(){this.bus.push(this.value)},{getNewCell:function(t){return new e(t)}}}(),SpreadSheetFactory=function(){function e(e){this.cells=[],this.addCells(e)}return e.prototype.getCellById=function(e){return _.find(this.cells,{id:e})},e.prototype.addCells=function(e){e=_.isArray(e)?e:[],e=e.map(function(e){return CellFactory.getNewCell(e)}),Array.prototype.push.apply(this.cells,e)},e.prototype.addCell=function(e){this.cells.push(CellFactory.getNewCell(e))},e.prototype.removeCellsById=function(e){e=_.isArray(e)?e:[],_.forEach(e,function(e){_.remove(this.cells,function(t){return t.id===e})})},e.prototype.removeCellById=function(e){_.remove(this.cells,function(t){return t.id===e})},{getSpreadSheet:function(t){return new e(t)}}}(),spreadSheet=SpreadSheetFactory.getSpreadSheet();drawSpreadSheet(10,10);var INPUTS=$(".spreadsheet-cell"),cells=[],userId,socket=io.connect("http://localhost:5000");_.forEach([1,2],function(e){console.log("number:",e)}),socket.on("connect",function(e){socket.emit("join","Hello World from client"),socket.on("userid",function(e){userId=e});var t=Bacon.fromBinder(function(e){socket.on("update",function(t){e(t)})});processElements(t)});
=======
<<<<<<< Updated upstream
"use strict";function contrainValue(e,t,n){return t=t||0,n=n||10,e=_.isFinite(e)?e:1,e=Math.max(t,e),e=Math.min(n,e)}function drawSpreadSheet(e,t){e=contrainValue(e,1,27),t=contrainValue(t,1,20);for(var n=document.querySelector("table"),r=0;r<t;r++)for(var o=n.insertRow(-1),a=0;a<e;a++){var l=String.fromCharCode("A".charCodeAt(0)+a-1);o.insertCell(-1).innerHTML=r&&a?"<input id='"+l+r+"' class='spreadsheet-cell' />":r||l}}function processElements(e,t){function n(e,t){return e+t}function r(e,t){return e-t}function o(e,t){return e*t}function a(e,t){return 0===t?0:e/t}function l(e,t,n){var r="",o=s(e.left,n);return r=e.right?s(e.right,n):Bacon.constant(0),o.combine(r,t)}function s(e,t){var i=0,c=0,u=0;if("number"===e.type)u=Bacon.constant(parseFloat(e.token));else if("cellname"===e.type)u=spreadSheet.getCellById(e.token),t.push(u),u=u.bus;else if("unary"===e.type)c=s(e.right,t),"+"===e.token?u=c:(i=Bacon.constant(0),u=i.combine(c,r));else if("leftparen"===e.type)i=s(e.left,t),c=e.right,"rightparen"===c.type&&(u=i);else if("operator"===e.type)switch(e.token){case"+":u=l(e,n,t);break;case"-":u=l(e,r,t);break;case"*":u=l(e,o,t);break;case"/":u=l(e,a,t)}return u}function i(e,t,n){e.value=n,t.is(":focus")?t.val(e.formula):t.val(e.value),localStorage[e.id]=e.formula,console.log("cell:",e.id,e.value),e.pusher()}INPUTS.each(function(t,n){var r=$(n),o={element:r,id:r.attr("id")},a=[];cells.push(o),e.filter(function(e){return e.element===o.id}).onValue(function(e){var t=spreadSheet.getCellById(e.element),n=e.formula.toUpperCase(),o="x"+(new Date).getTime();console.log("date stamps:",e.timestamp,t.lastUpdated),e.timestamp>t.lastUpdated?(a=[],t.formula=n,t.dispose&&t.dispose(),t.dispose=null,_.isUndefined(n)||""===n?(i(t,r,0),t.expanded="0"):(n=window.parser.parse(n.replace("=","")),t.dispose=s(n,a).onValue(function(e){console.log("id:",o),i(t,r,e)}),a=_.uniqBy(a,function(e){return e.id}),_.forEach(a,function(e){e.pusher()}))):console.log("server update rejected:",e)}),r.asEventStream("focus").onValue(function(e){var t=e.target.id,n=spreadSheet.getCellById(t),o=n.formula;r.val(o)}),r.asEventStream("blur").map(function(e){var t=e.target.id,n=e.target.value;return{element:t,formula:n,user_id:userId}}).onValue(function(e){socket.emit("write",e)})}),spreadSheet.addCells(cells),window.parser.setSpreadSheet(spreadSheet),e.onValue(function(e){console.log("update:",e)})}var _=_,Bacon=Bacon,CellFactory=function(){function e(e){this.id=e.id,this.element=e.element,this.value=0,this.expanded="0",this.lastUpdated=0,this.dispose=null,this.bus=new Bacon.Bus}return e.prototype.pusher=function(){this.bus.push(this.value)},{getNewCell:function(t){return new e(t)}}}(),SpreadSheetFactory=function(){function e(e){this.cells=[],this.addCells(e)}return e.prototype.getCellById=function(e){return _.find(this.cells,{id:e})},e.prototype.addCells=function(e){e=_.isArray(e)?e:[],e=e.map(function(e){return CellFactory.getNewCell(e)}),Array.prototype.push.apply(this.cells,e)},e.prototype.addCell=function(e){this.cells.push(CellFactory.getNewCell(e))},e.prototype.removeCellsById=function(e){e=_.isArray(e)?e:[],_.forEach(e,function(e){_.remove(this.cells,function(t){return t.id===e})})},e.prototype.removeCellById=function(e){_.remove(this.cells,function(t){return t.id===e})},{getSpreadSheet:function(t){return new e(t)}}}(),spreadSheet=SpreadSheetFactory.getSpreadSheet();drawSpreadSheet(10,10);var INPUTS=$(".spreadsheet-cell"),cells=[],userId,socket=io.connect("http://localhost:5000");socket.on("connect",function(e){socket.emit("join","Hello World from client"),socket.on("userid",function(e){userId=e});var t=Bacon.fromBinder(function(e){socket.on("update",function(t){e(t)})});processElements(t)});
=======
"use strict";function contrainValue(e,t,n){return t=t||0,n=n||10,e=_.isFinite(e)?e:1,e=Math.max(t,e),e=Math.min(n,e)}function drawSpreadSheet(e,t){e=contrainValue(e,1,27),t=contrainValue(t,1,20);for(var n=document.querySelector("table"),r=0;r<t;r++)for(var o=n.insertRow(-1),a=0;a<e;a++){var i=String.fromCharCode("A".charCodeAt(0)+a-1);o.insertCell(-1).innerHTML=r&&a?"<input id='"+i+r+"' class='spreadsheet-cell' />":r||i}}function processElements(e,t){function n(e,t){return e+t}function r(e,t){return e-t}function o(e,t){return e*t}function a(e,t){return 0===t?0:e/t}function i(e,t,n){var r="",o=l(e.left,n);return r=e.right?l(e.right,n):Bacon.constant(0),o.combine(r,t)}function l(e,t){var c=0,u=0,s=0;if("number"===e.type)s=Bacon.constant(parseFloat(e.token));else if("cellname"===e.type)s=spreadSheet.getCellById(e.token),t.push(s),s=s.bus;else if("unary"===e.type)u=l(e.right,t),"+"===e.token?s=u:(c=Bacon.constant(0),s=c.combine(u,r));else if("leftparen"===e.type)c=l(e.left,t),u=e.right,"rightparen"===u.type&&(s=c);else if("operator"===e.type)switch(e.token){case"+":s=i(e,n,t);break;case"-":s=i(e,r,t);break;case"*":s=i(e,o,t);break;case"/":s=i(e,a,t)}return s}function c(e,t,n){e.value=n,t.is(":focus")?t.val(e.formula):t.val(e.value),localStorage[e.id]=e.formula,console.log("cell:",e.id,e.value),e.pusher()}INPUTS.each(function(t,n){var r=$(n),o={element:r,id:r.attr("id")},a=[];cells.push(o),e.filter(function(e){return e.element===o.id}).onValue(function(e){var t=spreadSheet.getCellById(e.element),n=e.formula.toUpperCase();a=[],t.formula=n,_.isUndefined(n)||""===n?(c(t,r,0),t.expanded="0"):(n=window.parser.parse(n.replace("=","")),l(n,a).onValue(function(e){c(t,r,e)}),a=_.uniqBy(a,function(e){return e.id}),_.forEach(a,function(e){e.pusher()}))}),r.asEventStream("focus").onValue(function(e){var t=e.target.id,n=spreadSheet.getCellById(t),o=n.formula;r.val(o)}),r.asEventStream("blur").map(function(e){var t=e.target.id,n=e.target.value;return{element:t,formula:n,user_id:userId}}).onValue(function(e){socket.emit("write",e)})}),spreadSheet.addCells(cells),window.parser.setSpreadSheet(spreadSheet)}var _=_,Bacon=Bacon,CellFactory=function(){function e(e){this.id=e.id,this.element=e.element,this.value=0,this.expanded="0",this.bus=new Bacon.Bus}return e.prototype.pusher=function(){this.bus.push(this.value)},{getNewCell:function(t){return new e(t)}}}(),SpreadSheetFactory=function(){function e(e){this.cells=[],this.addCells(e)}return e.prototype.getCellById=function(e){return _.find(this.cells,{id:e})},e.prototype.addCells=function(e){e=_.isArray(e)?e:[],e=e.map(function(e){return CellFactory.getNewCell(e)}),Array.prototype.push.apply(this.cells,e)},e.prototype.addCell=function(e){this.cells.push(CellFactory.getNewCell(e))},e.prototype.removeCellsById=function(e){e=_.isArray(e)?e:[],_.forEach(e,function(e){_.remove(this.cells,function(t){return t.id===e})})},e.prototype.removeCellById=function(e){_.remove(this.cells,function(t){return t.id===e})},{getSpreadSheet:function(t){return new e(t)}}}(),spreadSheet=SpreadSheetFactory.getSpreadSheet();drawSpreadSheet(10,10);var INPUTS=$(".spreadsheet-cell"),cells=[],userId,socket=io.connect("http://localhost:5000");socket.on("connect",function(e){socket.emit("join","Hello World from client"),socket.on("userid",function(e){userId=e});var t=Bacon.fromBinder(function(e){socket.on("update",function(t){e(t)})}),n=Bacon.fromBinder(function(e){socket.on("messages",function(t){e(t)})});processElements(t,n)});
>>>>>>> Stashed changes
>>>>>>> Stashed changes
//# sourceMappingURL=spreadsheet.js.map
