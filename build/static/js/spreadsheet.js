"use strict";for(var _=_,Bacon=Bacon,Cell=function(e){this.id=e.id,this.element=e.element,this.bus=new Bacon.Bus},SpreadSheetFactory=function(){function e(e){this.cells=[],this.addCells(e)}return e.prototype.addCells=function(e){e=_.isArray(e)?e:[],e=e.map(function(e){return new Cell(e)}),Array.prototype.push.apply(this.cells,e)},e.prototype.addCell=function(e){this.cells.push(new Cell(e))},e.prototype.removeCellsById=function(e){e=_.isArray(e)?e:[],_.forEach(e,function(e){_.remove(this.cells,function(t){return t.id===e})})},e.prototype.removeCellById=function(e){_.remove(this.cells,function(t){return t.id===e})},{getSpreadSheet:function(t){return new e(t)}}}(),spreadSheet=SpreadSheetFactory.getSpreadSheet(),i=0;i<6;i++)for(var row=document.querySelector("table").insertRow(-1),j=0;j<6;j++){var letter=String.fromCharCode("A".charCodeAt(0)+j-1);row.insertCell(-1).innerHTML=i&&j?"<input id='"+letter+i+"'/>":i||letter}var DATA={},INPUTS=$("input"),cells=[];INPUTS.each(function(e,t){function r(e){var t=0,o=0,n=0;if("number"===e.type)n=parseFloat(e.token);else if("cellname"===e.type)n=DATA[e.token];else if("unary"===e.type)o=r(e.right),n="+"===e.token?o:0-o;else if("leftparen"===e.type)t=r(e.left),o=e.right,"rightparen"===o.type&&(n=t);else if("operator"===e.type)switch(e.token){case"+":case"-":t=r(e.left),o=e.right?r(e.right):0,n="+"===e.token?t+o:t-o;break;case"*":case"/":t=r(e.left),o=e.right?r(e.right):1,n="*"===e.token?t*o:t/o}return n}function o(){var e=localStorage[n.attr("id")]||"",t=0;return"="===e.charAt(0)?(e=window.parser(e.substring(1)),t=r(e)):isNaN(parseFloat(e))?e:parseFloat(e)}var n=$(t);cells.push({element:n,id:n.attr("id")}),n.asEventStream("focus").onValue(function(e){e.target.value=localStorage[e.target.id]||""}),n.asEventStream("blur").onValue(function(e){var t=e.target.id,r=e.target.value;localStorage[t]=r,socket.emit("write",{element:t,value:r,user_id:userId})}),Object.defineProperty(DATA,n.attr("id"),{get:o}),Object.defineProperty(DATA,n.attr("id").toLowerCase(),{get:o})});var userId,socket=io.connect("http://localhost:5000");socket.on("connect",function(e){socket.emit("join","Hello World from client")}),socket.on("userid",function(e){userId=e}),socket.on("update",function(e){console.log("write: ",e)}),socket.on("messages",function(e){console.log("messages:",e)}),spreadSheet.addCells(cells);
//# sourceMappingURL=spreadsheet.js.map
