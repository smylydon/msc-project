"use strict";window.parser=function(){function r(r){for(var e,t=[],n=/([A-Z]([1-9]\d+|[1-9])|\d+(\.\d+)?|[+\-\/\*]|\(|\))/gi;null!==(e=n.exec(r));)t.push(e[0]);return t}function e(){return h[v]}function t(){var r=e();return v++,r}function n(r,e){return v++,{token:r,type:e}}function a(){var r={},t=e();return y.test(t)?(r=n(t,"unary"),r.right=i()):m.test(t)?r=n(t,"number"):/^\($/.test(t)?(r=n(t,"leftparen"),r.left=i(),t=e(),")"===t&&(r.right=n(t,"rightparen"))):r=C.test(t)?n(t,"cellname"):n(t,""),r}function o(){for(var r=a(),n=e();"*"===n||"/"===n;)n=t(),r={token:n,type:"operator",left:r,right:a()},n=e();return r}function i(){for(var r=o(),n=e();"+"===n||"-"===n;)n=t(),r={token:n,type:"operator",left:r,right:o()},n=e();return r}function u(r){return String.fromCharCode(r.charCodeAt(0)+1)}function c(r,e,t){return r=r.replace(/^\+/,""),r="("+r+")","mean"===e&&(r="("+r+"/"+t+")"),r}function f(r){var e,t="",n="",a="",o="",i=0,f="#ERROR",s=/sum/i.test(r)?"sum":"mean";if(r=r.replace(/(sum|avg|mean|[\(\)]+)/gi,"").replace(" ",""),e=r.split(":"),t=e[0][0],n=e[1][0],a=parseInt(e[0][1]),o=parseInt(e[1][1]),t===n){if(o>=a){for(f="";a<=o;)f+="+"+t+a,a++,i++;f=c(f,s,i)}}else if(n>=t&&o===a){for(f="";t<=n;)f+="+"+t+a,t=u(t),i++;f=c(f,s,i)}return console.log(">>>",f),f}function s(r){g=r}function l(r,e){var t=g.getCellById(e),n=t.formula;if(E.test(n))if(r.indexOf(e)<0){var a=[t.id];Array.prototype.push.apply(a,r),e=n.replace(E,p(l,a))}else console.log("#ERROR CYCULAR DEPENDENCY",e,r),e="#ERROR CYCULAR DEPENDENCY";return e}function p(){var r=Array.prototype.slice.call(arguments),e=r.shift();return function(){return e.apply(e,r.concat(Array.prototype.slice.call(arguments)))}}function R(e,t){return e=e||"",v=0,e=e.replace(d,f),e=e.replace(E,p(l,[t])),/ERROR/gi.test(e)?e=/CIRCULAR/gi.test(e)?"#ERROR CYCULAR DEPENDENCY":"#ERROR":(h=r(e),e=i()),e}var g,d=/(sum|avg|mean)\(\s*[a-z]([1-9]\d+|[1-9])\s*:\s*[a-z]([1-9]\d+|[1-9])\s*\)/gi,C=/^[A-Z]([1-9]\d+|[1-9])$/i,E=/[A-Z]([1-9]\d+|[1-9])/gi,y=/[+\-\/\*]/,m=/^\d+(\.\d+)?$/,v=0,h=[];return{parse:R,setSpreadSheet:s}}();
//# sourceMappingURL=parser.js.map
