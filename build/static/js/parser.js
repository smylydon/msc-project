"use strict";window.parser=function(){function e(e){for(var r,t=[];null!==(r=A.exec(e));)t.push(r[0]);return t}function r(){return y[v]}function t(){var e=r();return v++,e}function n(e,r){return v++,{token:e,type:r}}function o(){var e={},t=r();return h.test(t)?(e=n(t,"unary"),e.right=i()):m.test(t)?e=n(t,"number"):/^\($/.test(t)?(e=n(t,"leftparen"),e.left=i(),t=r(),")"===t&&(e.right=n(t,"rightparen"))):e=C.test(t)?n(t,"cellname"):n(t,""),e}function a(){for(var e=o(),n=r();"*"===n||"/"===n||"^"===n;)n=t(),e={token:n,type:"operator",left:e,right:o()},n=r();return e}function i(){for(var e=a(),n=r();"+"===n||"-"===n;)n=t(),e={token:n,type:"operator",left:e,right:a()},n=r();return e}function u(e){return String.fromCharCode(e.charCodeAt(0)+1)}function c(e,r,t){return e=e.replace(/^\+/,""),e="("+e+")","mean"===r&&(e="("+e+"/"+t+")"),e}function l(e){var r,t="",n="",o="",a="",i=0,l="#ERROR",f=/sum/i.test(e)?"sum":"mean";if(e=e.replace(/(sum|avg|mean|[\(\)]+)/gi,"").replace(" ",""),r=e.split(":"),t=r[0][0],n=r[1][0],o=parseInt(r[0][1]),a=parseInt(r[1][1]),t===n){if(a>=o){for(l="";o<=a;)l+="+"+t+o,o++,i++;l=c(l,f,i)}}else if(n>=t&&a===o){for(l="";t<=n;)l+="+"+t+o,t=u(t),i++;l=c(l,f,i)}return console.log(">>>",l),l}function f(e){g=e}function s(e,r){var t=g.getCellById(r),n=t.formula;if(E.test(n))if(e.indexOf(r)<0){var o=[t.id];Array.prototype.push.apply(o,e),r=n.replace(E,p(s,o))}else console.log("#ERROR CYCULAR DEPENDENCY",r,e),r="#ERROR CYCULAR DEPENDENCY";var a=r.match(A);return a.length>1&&(r="("+r+")"),r}function p(){var e=Array.prototype.slice.call(arguments),r=e.shift();return function(){return r.apply(r,e.concat(Array.prototype.slice.call(arguments)))}}function R(r,t){return r=r||"",v=0,r=r.replace(d,l),r=r.replace(E,p(s,[t])),/ERROR/gi.test(r)?r=/CIRCULAR/gi.test(r)?"#ERROR CYCULAR DEPENDENCY":"#ERROR":(console.log("tokenize:",r),y=e(r),r=i()),r}var g,d=/(sum|avg|mean)\(\s*[a-z]([1-9]\d+|[1-9])\s*:\s*[a-z]([1-9]\d+|[1-9])\s*\)/gi,C=/^[A-Z]([1-9]\d+|[1-9])$/i,E=/[A-Z]([1-9]\d+|[1-9])/gi,h=/[+\-\/\*\^]/,m=/^\d+(\.\d+)?$/,v=0,y=[],A=/([A-Z]([1-9]\d+|[1-9])|\d+(\.\d+)?|[+\-\/\*\^]|\(|\))/gi;return{parse:R,setSpreadSheet:f}}();
//# sourceMappingURL=parser.js.map
