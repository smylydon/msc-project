{"version":3,"sources":["spreadsheet.js"],"names":["_","Bacon","Cell","cell","this","id","element","bus","Bus","SpreadSheetFactory","SpreadSheet","cells","addCells","prototype","isArray","map","Array","push","apply","addCell","removeCellsById","ids","forEach","remove","removeCellById","getSpreadSheet","spreadSheet","i","row","document","querySelector","insertRow","j","letter","String","fromCharCode","charCodeAt","insertCell","innerHTML","DATA","INPUTS","$","each","index","elem","calculate","token","left","right","value","type","parseFloat","getter","localStorage","attr","total","charAt","window","parser","substring","isNaN","asEventStream","onValue","event","target","elementid","socket","emit","user_id","userId","Object","defineProperty","get","toLowerCase","io","connect","on","data","console","log"],"mappings":"AAAA,YAwDA,KAAK,GAvDDA,GAAIA,EACJC,MAAQA,MAGRC,KAAO,SAAUC,GACpBC,KAAKC,GAAKF,EAAKE,GACfD,KAAKE,QAAUH,EAAKG,QAEpBF,KAAKG,IAAM,GAAIN,OAAMO,KAIlBC,mBAAsB,WACzB,QAASC,GAAYC,GACpBP,KAAKO,SACLP,KAAKQ,SAASD,GA8Bf,MA3BAD,GAAYG,UAAUD,SAAW,SAAUD,GAC1CA,EAAQX,EAAEc,QAAQH,GAASA,KAC3BA,EAAQA,EAAMI,IAAI,SAAUZ,GAC3B,MAAO,IAAID,MAAKC,KAEjBa,MAAMH,UAAUI,KAAKC,MAAMd,KAAKO,MAAOA,IAGxCD,EAAYG,UAAUM,QAAU,SAAUhB,GACzCC,KAAKO,MAAMM,KAAK,GAAIf,MAAKC,KAG1BO,EAAYG,UAAUO,gBAAkB,SAAUC,GACjDA,EAAMrB,EAAEc,QAAQO,GAAOA,KACvBrB,EAAEsB,QAAQD,EAAK,SAAUhB,GACxBL,EAAEuB,OAAOnB,KAAKO,MAAO,SAAUR,GAC9B,MAAOA,GAAKE,KAAOA,OAKtBK,EAAYG,UAAUW,eAAiB,SAAUnB,GAChDL,EAAEuB,OAAOnB,KAAKO,MAAO,SAAUR,GAC9B,MAAOA,GAAKE,KAAOA,MAKpBoB,eAAgB,SAAUd,GACzB,MAAO,IAAID,GAAYC,QAMtBe,YAAcjB,mBAAmBgB,iBAE5BE,EAAI,EAAGA,EAAI,EAAGA,IAGtB,IAAK,GAFDC,KAAMC,SAASC,cAAc,SAC/BC,cACOC,EAAI,EAAGA,EAAI,EAAGA,IAAK,CAC3B,GAAIC,QAASC,OAAOC,aAAa,IAAIC,WAAW,GAAKJ,EAAI,EACzDJ,KAAIS,eACFC,UAAYX,GAAKK,EAAI,cAAgBC,OAASN,EAAI,MACnDA,GAAKM,OAIR,GAAIM,SAEAC,OAASC,EAAE,SACX9B,QACJ6B,QAAOE,KAAK,SAAUC,EAAOC,GAwB5B,QAASC,GAAUC,GAClB,GAAIC,GAAO,EACPC,EAAQ,EACRC,EAAQ,CAEZ,IAAmB,WAAfH,EAAMI,KACTD,EAAQE,WAAWL,EAAMA,WACnB,IAAmB,aAAfA,EAAMI,KAChBD,EAAQV,KAAKO,EAAMA,WACb,IAAmB,UAAfA,EAAMI,KAChBF,EAAQH,EAAUC,EAAME,OACxBC,EAAwB,MAAhBH,EAAMA,MAAgBE,EAAQ,EAAIA,MACpC,IAAmB,cAAfF,EAAMI,KAChBH,EAAOF,EAAUC,EAAMC,MACvBC,EAAQF,EAAME,MACK,eAAfA,EAAME,OACTD,EAAQF,OAEH,IAAmB,aAAfD,EAAMI,KAChB,OAAQJ,EAAMA,OACb,IAAK,IACL,IAAK,IACJC,EAAOF,EAAUC,EAAMC,MACvBC,EAAQF,EAAME,MAAQH,EAAUC,EAAME,OAAS,EAC/CC,EAAwB,MAAhBH,EAAMA,MAAiBC,EAAOC,EAAUD,EAAOC,CACvD,MACD,KAAK,IACL,IAAK,IACJD,EAAOF,EAAUC,EAAMC,MACvBC,EAAQF,EAAME,MAAQH,EAAUC,EAAME,OAAS,EAC/CC,EAAwB,MAAhBH,EAAMA,MAAiBC,EAAOC,EAAUD,EAAOC,EAI1D,MAAOC,GAGR,QAASG,KACR,GAAIH,GAAQI,aAAa/C,EAAQgD,KAAK,QAAU,GAC5CC,EAAQ,CACZ,OAAwB,MAApBN,EAAMO,OAAO,IAChBP,EAAQQ,OAAOC,OAAOT,EAAMU,UAAU,IACtCJ,EAAQV,EAAUI,IAIXW,MAAMT,WAAWF,IAAUA,EAAQE,WAAWF,GArEvD,GAAI3C,GAAUmC,EAAEG,EAChBjC,OAAMM,MACLX,QAASA,EACTD,GAAIC,EAAQgD,KAAK,QAElBhD,EAAQuD,cAAc,SACpBC,QAAQ,SAAUC,GAClBA,EAAMC,OAAOf,MAAQI,aAAaU,EAAMC,OAAO3D,KAAO,KAGxDC,EAAQuD,cAAc,QACpBC,QAAQ,SAAUC,GAClB,GAAIE,GAAYF,EAAMC,OAAO3D,GACzB4C,EAAQc,EAAMC,OAAOf,KACzBI,cAAaY,GAAahB,EAE1BiB,OAAOC,KAAK,SACX7D,QAAS2D,EACThB,MAAOA,EACPmB,QAASC,WAsDZC,OAAOC,eAAehC,KAAMjC,EAAQgD,KAAK,OACxCkB,IAAKpB,IAGNkB,OAAOC,eAAehC,KAAMjC,EAAQgD,KAAK,MACvCmB,eACAD,IAAKpB,KAmBR,IAAIiB,QAEAH,OAASQ,GAAGC,QAAQ,wBAGxBT,QAAOU,GAAG,UAAW,SAAUC,GAC9BX,OAAOC,KAAK,OAAQ,6BAGrBD,OAAOU,GAAG,SAAU,SAAUC,GAC7BR,OAASQ,IAGVX,OAAOU,GAAG,SAAU,SAAUC,GAC7BC,QAAQC,IAAI,UAAWF,KAGxBX,OAAOU,GAAG,WAAY,SAAUC,GAC/BC,QAAQC,IAAI,YAAaF,KAG1BnD,YAAYd,SAASD","file":"spreadsheet.js","sourcesContent":["/* eslint-disable */\nvar _ = _;\nvar Bacon = Bacon;\n/* eslint-enable */\n\nvar Cell = function (cell) {\n\tthis.id = cell.id;\n\tthis.element = cell.element;\n\t/* eslint-disable */\n\tthis.bus = new Bacon.Bus();\n\t/* eslint-enable */\n};\n\nvar SpreadSheetFactory = (function () {\n\tfunction SpreadSheet(cells) {\n\t\tthis.cells = [];\n\t\tthis.addCells(cells);\n\t}\n\n\tSpreadSheet.prototype.addCells = function (cells) {\n\t\tcells = _.isArray(cells) ? cells : [];\n\t\tcells = cells.map(function (cell) {\n\t\t\treturn new Cell(cell);\n\t\t});\n\t\tArray.prototype.push.apply(this.cells, cells);\n\t};\n\n\tSpreadSheet.prototype.addCell = function (cell) {\n\t\tthis.cells.push(new Cell(cell));\n\t};\n\n\tSpreadSheet.prototype.removeCellsById = function (ids) {\n\t\tids = _.isArray(ids) ? ids : [];\n\t\t_.forEach(ids, function (id) {\n\t\t\t_.remove(this.cells, function (cell) {\n\t\t\t\treturn cell.id === id;\n\t\t\t});\n\t\t});\n\t};\n\n\tSpreadSheet.prototype.removeCellById = function (id) {\n\t\t_.remove(this.cells, function (cell) {\n\t\t\treturn cell.id === id;\n\t\t});\n\t};\n\n\treturn {\n\t\tgetSpreadSheet: function (cells) {\n\t\t\treturn new SpreadSheet(cells);\n\t\t}\n\t};\n\n})();\n\nvar spreadSheet = SpreadSheetFactory.getSpreadSheet();\n\nfor (var i = 0; i < 6; i++) {\n\tvar row = document.querySelector(\"table\")\n\t\t.insertRow(-1);\n\tfor (var j = 0; j < 6; j++) {\n\t\tvar letter = String.fromCharCode(\"A\".charCodeAt(0) + j - 1);\n\t\trow.insertCell(-1)\n\t\t\t.innerHTML = i && j ? \"<input id='\" + letter + i + \"'/>\" :\n\t\t\ti || letter;\n\t}\n}\n\nvar DATA = {};\n\nvar INPUTS = $('input'); //get all inputs\nvar cells = [];\nINPUTS.each(function (index, elem) {\n\tvar element = $(elem);\n\tcells.push({\n\t\telement: element,\n\t\tid: element.attr('id')\n\t});\n\telement.asEventStream('focus')\n\t\t.onValue(function (event) {\n\t\t\tevent.target.value = localStorage[event.target.id] || \"\";\n\t\t});\n\n\telement.asEventStream('blur')\n\t\t.onValue(function (event) {\n\t\t\tvar elementid = event.target.id;\n\t\t\tvar value = event.target.value;\n\t\t\tlocalStorage[elementid] = value;\n\t\t\t//window.computeAll();\n\t\t\tsocket.emit('write', {\n\t\t\t\telement: elementid,\n\t\t\t\tvalue: value,\n\t\t\t\tuser_id: userId\n\t\t\t});\n\t\t});\n\n\tfunction calculate(token) {\n\t\tvar left = 0;\n\t\tvar right = 0;\n\t\tvar value = 0;\n\n\t\tif (token.type === 'number') {\n\t\t\tvalue = parseFloat(token.token);\n\t\t} else if (token.type === 'cellname') {\n\t\t\tvalue = DATA[token.token];\n\t\t} else if (token.type === 'unary') {\n\t\t\tright = calculate(token.right);\n\t\t\tvalue = token.token === '+' ? right : 0 - right;\n\t\t} else if (token.type === \"leftparen\") {\n\t\t\tleft = calculate(token.left);\n\t\t\tright = token.right;\n\t\t\tif (right.type === 'rightparen') {\n\t\t\t\tvalue = left;\n\t\t\t}\n\t\t} else if (token.type === 'operator') {\n\t\t\tswitch (token.token) {\n\t\t\t\tcase '+':\n\t\t\t\tcase '-':\n\t\t\t\t\tleft = calculate(token.left);\n\t\t\t\t\tright = token.right ? calculate(token.right) : 0;\n\t\t\t\t\tvalue = token.token === '+' ? (left + right) : (left - right);\n\t\t\t\t\tbreak;\n\t\t\t\tcase '*':\n\t\t\t\tcase '/':\n\t\t\t\t\tleft = calculate(token.left);\n\t\t\t\t\tright = token.right ? calculate(token.right) : 1;\n\t\t\t\t\tvalue = token.token === '*' ? (left * right) : (left / right);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn value;\n\t}\n\n\tfunction getter() {\n\t\tvar value = localStorage[element.attr('id')] || \"\";\n\t\tvar total = 0;\n\t\tif (value.charAt(0) === \"=\") {\n\t\t\tvalue = window.parser(value.substring(1));\n\t\t\ttotal = calculate(value);\n\t\t\t//DATA\n\t\t\treturn total;\n\t\t} else {\n\t\t\treturn isNaN(parseFloat(value)) ? value : parseFloat(value);\n\t\t}\n\t}\n\n\tObject.defineProperty(DATA, element.attr('id'), {\n\t\tget: getter\n\t});\n\n\tObject.defineProperty(DATA, element.attr('id')\n\t\t.toLowerCase(), {\n\t\t\tget: getter\n\t\t});\n\n});\n/*\nwindow.computeAll = (function () {\n\treturn function () {\n\t\tINPUTS.each(function (index, elem) {\n\t\t\tvar element = $(elem);\n\t\t\t//console.log('computeAll:', element, elem);\n\t\t\ttry {\n\t\t\t\telement.val(DATA[element.attr('id')]);\n\t\t\t} catch (exception) {\n\t\t\t\t//console.warn('Exception:', exception);\n\t\t\t}\n\t\t});\n\t};\n})();*/\n\nvar userId;\n/* eslint-disable */\nvar socket = io.connect('http://localhost:5000');\n/* eslint-enable */\n\nsocket.on('connect', function (data) {\n\tsocket.emit('join', 'Hello World from client');\n});\n\nsocket.on('userid', function (data) {\n\tuserId = data;\n});\n\nsocket.on('update', function (data) {\n\tconsole.log('write: ', data);\n});\n\nsocket.on('messages', function (data) {\n\tconsole.log('messages:', data);\n});\n\nspreadSheet.addCells(cells);\n"],"sourceRoot":"/source/"}