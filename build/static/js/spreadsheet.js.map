{"version":3,"sources":["spreadsheet.js"],"names":["i","row","document","querySelector","insertRow","j","letter","String","fromCharCode","charCodeAt","insertCell","innerHTML","DATA","INPUTS","$","each","index","elem","calculate","token","left","right","value","type","parseFloat","getter","localStorage","element","attr","total","charAt","window","parser","substring","isNaN","asEventStream","onValue","event","target","id","elementid","socket","emit","user_id","userId","computeAll","Object","defineProperty","get","toLowerCase","val","exception","io","connect","on","data","console","log"],"mappings":"AAAA,YAAA,KAAK,GAAIA,GAAI,EAAGA,EAAI,EAAGA,IAGtB,IAAK,GAFDC,KAAMC,SAASC,cAAc,SAC/BC,cACOC,EAAI,EAAGA,EAAI,EAAGA,IAAK,CAC3B,GAAIC,QAASC,OAAOC,aAAa,IAAIC,WAAW,GAAKJ,EAAI,EACzDJ,KAAIS,eACFC,UAAYX,GAAKK,EAAI,cAAgBC,OAASN,EAAI,MACnDA,GAAKM,OAIR,GAAIM,SAEAC,OAASC,EAAE,QAEfD,QAAOE,KAAK,SAAUC,EAAOC,GAqB5B,QAASC,GAAUC,GAClB,GAAIC,GAAO,EACPC,EAAQ,EACRC,EAAQ,CAEZ,IAAmB,WAAfH,EAAMI,KACTD,EAAQE,WAAWL,EAAMA,WACnB,IAAmB,aAAfA,EAAMI,KAChBD,EAAQV,KAAKO,EAAMA,WACb,IAAmB,UAAfA,EAAMI,KAChBF,EAAQH,EAAUC,EAAME,OACxBC,EAAwB,MAAhBH,EAAMA,MAAgBE,EAAQ,EAAIA,MACpC,IAAmB,cAAfF,EAAMI,KAChBH,EAAOF,EAAUC,EAAMC,MACvBC,EAAQF,EAAME,MACK,eAAfA,EAAME,OACTD,EAAQF,OAEH,IAAmB,aAAfD,EAAMI,KAChB,OAAQJ,EAAMA,OACd,IAAK,IACL,IAAK,IACJC,EAAOF,EAAUC,EAAMC,MACvBC,EAAQF,EAAME,MAAQH,EAAUC,EAAME,OAAS,EAC/CC,EAAwB,MAAhBH,EAAMA,MAAiBC,EAAOC,EAAUD,EAAOC,CACvD,MACD,KAAK,IACL,IAAK,IACJD,EAAOF,EAAUC,EAAMC,MACvBC,EAAQF,EAAME,MAAQH,EAAUC,EAAME,OAAS,EAC/CC,EAAwB,MAAhBH,EAAMA,MAAiBC,EAAOC,EAAUD,EAAOC,EAIzD,MAAOC,GAGR,QAASG,KACR,GAAIH,GAAQI,aAAaC,EAAQC,KAAK,QAAU,GAC5CC,EAAQ,CACZ,OAAwB,MAApBP,EAAMQ,OAAO,IAChBR,EAAQS,OAAOC,OAAOV,EAAMW,UAAU,IACtCJ,EAAQX,EAAUI,IAIXY,MAAMV,WAAWF,IAAUA,EAAQE,WAAWF,GAlEvD,GAAIK,GAAUb,EAAEG,EAEhBU,GAAQQ,cAAc,SACpBC,QAAQ,SAAUC,GAClBA,EAAMC,OAAOhB,MAAQI,aAAaW,EAAMC,OAAOC,KAAO,KAGxDZ,EAAQQ,cAAc,QACpBC,QAAQ,SAAUC,GAClB,GAAIG,GAAYH,EAAMC,OAAOC,GACzBjB,EAAQe,EAAMC,OAAOhB,KACzBI,cAAac,GAAalB,EAC1BmB,OAAOC,KAAK,SACXf,QAASa,EACTlB,MAAOA,EACPqB,QAASC,SAEVb,OAAOc,eAqDTC,OAAOC,eAAenC,KAAMe,EAAQC,KAAK,OACxCoB,IAAKvB,IAGNqB,OAAOC,eAAenC,KAAMe,EAAQC,KAAK,MACvCqB,eACAD,IAAKvB,MAKRM,OAAOc,WAAc,WACpB,MAAO,YACNhC,OAAOE,KAAK,SAAUC,EAAOC,GAC5B,GAAIU,GAAUb,EAAEG,EAEhB,KACCU,EAAQuB,IAAItC,KAAKe,EAAQC,KAAK,QAC7B,MAAOuB,UAOZ,IAAIP,QAEAH,OAASW,GAAGC,QAAQ,wBAGxBZ,QAAOa,GAAG,UAAW,SAAUC,GAC9Bd,OAAOC,KAAK,OAAQ,6BAGrBD,OAAOa,GAAG,SAAU,SAAUC,GAC7BX,OAASW,IAGVd,OAAOa,GAAG,SAAU,SAAUC,GAC7BC,QAAQC,IAAI,UAAWF,KAGxBd,OAAOa,GAAG,WAAY,SAAUC,GAC/BC,QAAQC,IAAI,YAAaF","file":"spreadsheet.js","sourcesContent":["for (var i = 0; i < 6; i++) {\n\tvar row = document.querySelector(\"table\")\n\t\t.insertRow(-1);\n\tfor (var j = 0; j < 6; j++) {\n\t\tvar letter = String.fromCharCode(\"A\".charCodeAt(0) + j - 1);\n\t\trow.insertCell(-1)\n\t\t\t.innerHTML = i && j ? \"<input id='\" + letter + i + \"'/>\" :\n\t\t\ti || letter;\n\t}\n}\n\nvar DATA = {};\n//var INPUTS = [].slice.call(document.querySelectorAll(\"input\"));\nvar INPUTS = $('input'); //get all inputs\n\nINPUTS.each(function (index, elem) {\n\tvar element = $(elem);\n\n\telement.asEventStream('focus')\n\t\t.onValue(function (event) {\n\t\t\tevent.target.value = localStorage[event.target.id] || \"\";\n\t\t});\n\n\telement.asEventStream('blur')\n\t\t.onValue(function (event) {\n\t\t\tvar elementid = event.target.id;\n\t\t\tvar value = event.target.value;\n\t\t\tlocalStorage[elementid] = value;\n\t\t\tsocket.emit('write', {\n\t\t\t\telement: elementid,\n\t\t\t\tvalue: value,\n\t\t\t\tuser_id: userId\n\t\t\t});\n\t\t\twindow.computeAll();\n\t\t});\n\n\tfunction calculate(token) {\n\t\tvar left = 0;\n\t\tvar right = 0;\n\t\tvar value = 0;\n\n\t\tif (token.type === 'number') {\n\t\t\tvalue = parseFloat(token.token);\n\t\t} else if (token.type === 'cellname') {\n\t\t\tvalue = DATA[token.token];\n\t\t} else if (token.type === 'unary') {\n\t\t\tright = calculate(token.right);\n\t\t\tvalue = token.token === '+' ? right : 0 - right;\n\t\t} else if (token.type === \"leftparen\") {\n\t\t\tleft = calculate(token.left);\n\t\t\tright = token.right;\n\t\t\tif (right.type === 'rightparen') {\n\t\t\t\tvalue = left;\n\t\t\t}\n\t\t} else if (token.type === 'operator') {\n\t\t\tswitch (token.token) {\n\t\t\tcase '+':\n\t\t\tcase '-':\n\t\t\t\tleft = calculate(token.left);\n\t\t\t\tright = token.right ? calculate(token.right) : 0;\n\t\t\t\tvalue = token.token === '+' ? (left + right) : (left - right);\n\t\t\t\tbreak;\n\t\t\tcase '*':\n\t\t\tcase '/':\n\t\t\t\tleft = calculate(token.left);\n\t\t\t\tright = token.right ? calculate(token.right) : 1;\n\t\t\t\tvalue = token.token === '*' ? (left * right) : (left / right);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn value;\n\t}\n\n\tfunction getter() {\n\t\tvar value = localStorage[element.attr('id')] || \"\";\n\t\tvar total = 0;\n\t\tif (value.charAt(0) === \"=\") {\n\t\t\tvalue = window.parser(value.substring(1));\n\t\t\ttotal = calculate(value);\n\t\t\t//DATA\n\t\t\treturn total;\n\t\t} else {\n\t\t\treturn isNaN(parseFloat(value)) ? value : parseFloat(value);\n\t\t}\n\t}\n\n\tObject.defineProperty(DATA, element.attr('id'), {\n\t\tget: getter\n\t});\n\n\tObject.defineProperty(DATA, element.attr('id')\n\t\t.toLowerCase(), {\n\t\t\tget: getter\n\t\t});\n\n});\n\nwindow.computeAll = (function () {\n\treturn function () {\n\t\tINPUTS.each(function (index, elem) {\n\t\t\tvar element = $(elem);\n\t\t\t//console.log('computeAll:', element, elem);\n\t\t\ttry {\n\t\t\t\telement.val(DATA[element.attr('id')]);\n\t\t\t} catch (exception) {\n\t\t\t\t//console.warn('Exception:', exception);\n\t\t\t}\n\t\t});\n\t};\n})();\n\nvar userId;\n/* eslint-disable */\nvar socket = io.connect('http://localhost:5000');\n/* eslint-enable */\n\nsocket.on('connect', function (data) {\n\tsocket.emit('join', 'Hello World from client');\n});\n\nsocket.on('userid', function (data) {\n\tuserId = data;\n});\n\nsocket.on('update', function (data) {\n\tconsole.log('write: ', data);\n});\n\nsocket.on('messages', function (data) {\n\tconsole.log('messages:', data);\n});\n"],"sourceRoot":"/source/"}